# PPOå­¦ç¿’è¨­å®šï¼ˆä¿®æ­£ç‰ˆ v2ï¼‰
# å…¨ã¦ã®å•é¡Œã‚’ä¿®æ­£

experiment:
  name: "hybrid_ppo_fixed_v2"
  description: "å…¨ã¦ã®å•é¡Œã‚’ä¿®æ­£ï¼š1)å­¦ç¿’æ™‚ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç„¡åŠ¹, 2)æ¨¡å€£å­¦ç¿’æœ‰åŠ¹, 3)å ±é…¬å†…éƒ¨æ§‹é€ ä¿®æ­£"
  seed: 42
  device: "cuda"

data:
  data_paths:
    grid_mapping: "data/tokyo/processed/grid_mapping_res9.json"
    travel_time_matrix: "data/tokyo/calibration2/linear_calibrated_response.npy"
  
  episode_duration_hours: 24
  exclude_daytime_ambulances: true
  
  area_restriction:
    enabled: true
    area_name: "æ±äº¬23åŒº"
    num_ambulances_in_area: 192
    state_dim: 999
    action_dim: 192
  
  # 1é€±é–“åˆ†ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿
  train_periods:
    - start_date: "20230615"
      end_date: "20230621"
  
  eval_periods:
    - start_date: "20230622"
      end_date: "20230622"
  
  max_steps_per_episode: 3000

ppo:
  n_episodes: 500  # ã¾ãš500ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆ
  batch_size: 1024
  n_epochs: 6
  clip_epsilon: 0.1
  learning_rate:
    actor: 0.0003
    critic: 0.001
  gamma: 0.99
  gae_lambda: 0.95
  entropy_coef: 0.015

reward:
  system:
    dispatch_failure: -1.0
    no_available_ambulance: 0.0
  
  core:
    mode: "hybrid"
    
    # ğŸ”¥ ä¿®æ­£: å ±é…¬å†…éƒ¨æ§‹é€ ã‚’å¿œç­”æ™‚é–“é‡è¦–ã«å¤‰æ›´
    hybrid_params:
      time_penalty_per_minute: -1.0        # -0.1 â†’ -1.0ï¼ˆ10å€å¼·åŒ–ï¼‰
      mild_under_13min_bonus: 15.0         # 5.0 â†’ 15.0
      moderate_under_13min_bonus: 20.0     # 10.0 â†’ 20.0
      over_13min_penalty: -20.0            # -5.0 â†’ -20.0ï¼ˆ4å€å¼·åŒ–ï¼‰
      over_20min_penalty: -100.0           # -50.0 â†’ -100.0
      
      # ã‚«ãƒãƒ¬ãƒƒã‚¸å ±é…¬ã‚’å¤§å¹…å‰Šæ¸›
      good_coverage_bonus: 2.0             # 10.0 â†’ 2.0ï¼ˆ1/5ï¼‰
      coverage_maintenance_bonus: 1.0      # 5.0 â†’ 1.0ï¼ˆ1/5ï¼‰
      poor_coverage_penalty: -3.0          # -10.0 â†’ -3.0ï¼ˆ1/3ï¼‰
      
      balanced_workload_bonus: 1.0
      overloaded_penalty: -2.0

# ğŸ”¥ ä¿®æ­£1: å­¦ç¿’æ™‚ã¯ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç„¡åŠ¹
hybrid_mode:
  enabled: false  # â† å­¦ç¿’æ™‚ã¯å…¨äº‹æ¡ˆã§å­¦ç¿’
  severity_classification:
    severe_conditions: ["é‡ç—‡", "é‡ç¯¤", "æ­»äº¡"]
    mild_conditions: ["è»½ç—‡", "ä¸­ç­‰ç—‡"]
  
  # æ¨è«–æ™‚ã®é‡ã¿ï¼ˆå­¦ç¿’ã«ã¯å½±éŸ¿ã—ãªã„ï¼‰
  reward_weights:
    response_time: 0.8    # ã•ã‚‰ã«å¼·åŒ– 0.7 â†’ 0.8
    coverage: 0.15        # ã•ã‚‰ã«å‰Šæ¸› 0.2 â†’ 0.15
    workload_balance: 0.05
  
  time_thresholds:
    good: 13
    warning: 20
  
  penalties:
    over_warning: -100.0
    per_minute_over: -5.0

network:
  state_encoder:
    ambulance_features: 8
    incident_features: 6
    spatial_features: 16
    temporal_features: 8
  
  actor:
    hidden_layers: [256, 128]
    activation: "relu"
    dropout: 0.1
  
  critic:
    hidden_layers: [256, 128]
    activation: "relu"
    dropout: 0.1

training:
  checkpoint_interval: 100
  keep_last_n: 5
  
  early_stopping:
    enabled: true
    patience: 20
    min_delta: 1.0
  
  logging:
    interval: 100
    tensorboard: true
    wandb: true
    wandb_project: "ems_hybrid_fixed_v2"

evaluation:
  interval: 50  # ã‚ˆã‚Šé »ç¹ã«è©•ä¾¡
  n_eval_episodes: 5
  compare_baselines: ["closest"]
  
  metrics:
    - "overall_mean_rt"
    - "mild_mean_rt"
    - "moderate_mean_rt"
    - "vs_closest_improvement"

# ğŸ”¥ ä¿®æ­£2: æ¨¡å€£å­¦ç¿’ã‚’æœ‰åŠ¹åŒ–
teacher:
  enabled: true              # â† æœ‰åŠ¹åŒ–
  strategy: "closest"        # ç›´è¿‘éšŠã‚’æ•™å¸«ã«
  initial_prob: 0.5          # åˆæœŸ50%æ¨¡å€£
  final_prob: 0.1            # æœ€çµ‚10%æ¨¡å€£
  decay_episodes: 200        # 200ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã§æ¸›è¡°
  apply_to: ["è»½ç—‡", "ä¸­ç­‰ç—‡", "é‡ç—‡", "é‡ç¯¤", "æ­»äº¡"]  # å…¨äº‹æ¡ˆ

