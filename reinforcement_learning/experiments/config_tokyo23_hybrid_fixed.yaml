# PPOå­¦ç¿’è¨­å®šï¼ˆä¿®æ­£ç‰ˆï¼‰
# å•é¡Œç‚¹ã‚’ä¿®æ­£ï¼šå¿œç­”æ™‚é–“ã‚’æœ€å„ªå…ˆã«

experiment:
  name: "hybrid_ppo_tokyo23_fixed_v1"
  description: "å ±é…¬é–¢æ•°ã‚’ä¿®æ­£ï¼šå¿œç­”æ™‚é–“é‡è¦–ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã¯è£œåŠ©çš„"
  seed: 42
  device: "cuda"

data:
  data_paths:
    grid_mapping: "data/tokyo/processed/grid_mapping_res9.json"
    travel_time_matrix: "data/tokyo/calibration2/linear_calibrated_response.npy"
  
  episode_duration_hours: 24
  exclude_daytime_ambulances: true
  
  area_restriction:
    enabled: true
    area_name: "æ±äº¬23åŒº"
    num_ambulances_in_area: 192
    state_dim: 999
    action_dim: 192
  
  # ã‚ˆã‚Šå¤šãã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿
  train_periods:
    - start_date: "20230615"
      end_date: "20230621"  # 1é€±é–“ã«æ‹¡å¼µ
  
  eval_periods:
    - start_date: "20230622"
      end_date: "20230622"
  
  max_steps_per_episode: 3000

ppo:
  n_episodes: 1000  # ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æ•°ã‚’å¢—åŠ 
  batch_size: 1024
  n_epochs: 6
  clip_epsilon: 0.1
  learning_rate:
    actor: 0.0003
    critic: 0.001
  gamma: 0.99
  gae_lambda: 0.95
  entropy_coef: 0.015

reward:
  system:
    dispatch_failure: -1.0
    no_available_ambulance: 0.0
  
  core:
    mode: "hybrid"
    hybrid_params:
      time_penalty_per_minute: -0.5  # å¿œç­”æ™‚é–“ãƒšãƒŠãƒ«ãƒ†ã‚£å¼·åŒ–
      mild_under_13min_bonus: 10.0   # ãƒœãƒ¼ãƒŠã‚¹å¢—åŠ 
      moderate_under_13min_bonus: 15.0
      over_13min_penalty: -10.0      # ãƒšãƒŠãƒ«ãƒ†ã‚£å¼·åŒ–
      over_20min_penalty: -100.0     # æ¥µç«¯ãªé…å»¶ã«å³ã—ã„ãƒšãƒŠãƒ«ãƒ†ã‚£
      good_coverage_bonus: 3.0       # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒœãƒ¼ãƒŠã‚¹æ¸›å°‘
      coverage_maintenance_bonus: 2.0
      poor_coverage_penalty: -3.0    # ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒšãƒŠãƒ«ãƒ†ã‚£ç·©å’Œ
      balanced_workload_bonus: 1.0
      overloaded_penalty: -2.0

# ğŸ”¥ æœ€é‡è¦ï¼šå ±é…¬ã®é‡ã¿èª¿æ•´
hybrid_mode:
  enabled: false  # å­¦ç¿’æ™‚ã¯ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç„¡åŠ¹ï¼ˆå…¨äº‹æ¡ˆã§å­¦ç¿’ï¼‰
  severity_classification:
    severe_conditions: ["é‡ç—‡", "é‡ç¯¤", "æ­»äº¡"]
    mild_conditions: ["è»½ç—‡", "ä¸­ç­‰ç—‡"]
  
  reward_weights:
    response_time: 0.7      # ğŸ”¥ 0.4 â†’ 0.7ï¼ˆå¿œç­”æ™‚é–“æœ€å„ªå…ˆï¼‰
    coverage: 0.2           # ğŸ”¥ 0.5 â†’ 0.2ï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ã¯è£œåŠ©ï¼‰
    workload_balance: 0.1
  
  time_thresholds:
    good: 13
    warning: 20
  
  penalties:
    over_warning: -100.0    # 20åˆ†è¶…éã«å³ã—ã„ãƒšãƒŠãƒ«ãƒ†ã‚£
    per_minute_over: -5.0

network:
  state_encoder:
    ambulance_features: 8
    incident_features: 6
    spatial_features: 16
    temporal_features: 8
  
  actor:
    hidden_layers: [256, 128]
    activation: "relu"
    dropout: 0.1
  
  critic:
    hidden_layers: [256, 128]
    activation: "relu"
    dropout: 0.1

training:
  checkpoint_interval: 100
  keep_last_n: 5
  
  early_stopping:
    enabled: true
    patience: 20
    min_delta: 1.0
  
  logging:
    interval: 100
    tensorboard: true
    wandb: true
    wandb_project: "ems_hybrid_fixed"

evaluation:
  interval: 100
  n_eval_episodes: 5
  compare_baselines: ["closest", "severity_based"]
  
  metrics:
    - "overall_mean_rt"      # æœ€é‡è¦ãƒ¡ãƒˆãƒªãƒƒã‚¯
    - "mild_mean_rt"
    - "moderate_mean_rt"
    - "critical_6min_rate"
    - "overall_13min_rate"
    - "coverage_score"
    - "vs_closest_improvement"

# æ¨¡å€£å­¦ç¿’ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
teacher:
  enabled: true              # ğŸ”¥ æœ‰åŠ¹åŒ–
  strategy: "closest"        # ç›´è¿‘éšŠã‚’æ•™å¸«ã«
  initial_prob: 0.5          # åˆæœŸã¯50%æ¨¡å€£
  final_prob: 0.1            # æœ€çµ‚ã¯10%æ¨¡å€£
  decay_episodes: 200        # 200ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã§æ¸›è¡°
  apply_to: ["è»½ç—‡", "ä¸­ç­‰ç—‡"]

